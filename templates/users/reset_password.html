<!-- ========================================
     RESET_PASSWORD.HTML - PREMIUM FIXED
     ======================================== -->

{% extends "base.html" %}
{% block title %}Redefinir Senha ¬∑ RoutineUp{% endblock %}

{% block content %}
<div class="auth-shell-premium">
  <section class="auth-left-premium reset-gradient">
    <div class="auth-gradient-bg"></div>
    <div class="auth-content-left">
      <div class="auth-logo-premium">
        <div class="logo-icon-premium">
          <i data-feather="lock"></i>
        </div>
        <h1 class="logo-text-premium">RoutineUp</h1>
      </div>
      
      <h2 class="auth-headline-premium">
        Defina uma<br/>
        <span class="gradient-text">nova senha.</span>
      </h2>
      
      <p class="auth-description-premium">
        Escolha uma senha forte e √∫nica para proteger sua conta e seus dados.
      </p>
      
      <div class="auth-features-premium">
        <div class="feature-item-premium">
          <div class="feature-icon-premium">
            <i data-feather="shield"></i>
          </div>
          <span>M√≠nimo de 6 caracteres</span>
        </div>
        <div class="feature-item-premium">
          <div class="feature-icon-premium">
            <i data-feather="check-circle"></i>
          </div>
          <span>Combine letras e n√∫meros</span>
        </div>
        <div class="feature-item-premium">
          <div class="feature-icon-premium">
            <i data-feather="alert-triangle"></i>
          </div>
          <span>N√£o compartilhe sua senha</span>
        </div>
      </div>
      
      <div class="password-strength-tips">
        <h3>Dicas para uma senha forte:</h3>
        <ul>
          <li>Use letras mai√∫sculas e min√∫sculas</li>
          <li>Inclua n√∫meros e s√≠mbolos</li>
          <li>Evite informa√ß√µes pessoais</li>
          <li>N√£o reutilize senhas</li>
        </ul>
      </div>
    </div>
  </section>

  <section class="auth-right-premium">
    <div class="auth-card-premium">
      <div class="auth-header-premium">
        <div class="auth-icon-large-premium">
          <i data-feather="shield-off"></i>
        </div>
        <h2 class="auth-title-premium">Criar Nova Senha üîí</h2>
        <p class="auth-subtitle-premium">
          Digite sua nova senha abaixo. Certifique-se de que seja forte.
        </p>
      </div>

      {% include "_partials/flash.html" %}

      <form method="post" action="{{ url_for('users.reset_password_post', token=token) }}" class="auth-form-premium" id="resetForm">
        <div class="form-group-premium">
          <label for="password">Nova Senha</label>
          <div class="input-wrapper-premium">
            <i data-feather="lock" class="input-icon-premium"></i>
            <input 
              type="password" 
              id="password" 
              name="password" 
              class="input-premium with-icon" 
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
              minlength="6"
              required 
              autofocus>
          </div>
          <div class="password-strength-bar">
            <div class="strength-fill" id="strengthFill"></div>
          </div>
          <small class="strength-text" id="strengthText">Digite uma senha</small>
        </div>

        <div class="form-group-premium">
          <label for="password_confirm">Confirmar Nova Senha</label>
          <div class="input-wrapper-premium">
            <i data-feather="check-circle" class="input-icon-premium"></i>
            <input 
              type="password" 
              id="password_confirm" 
              name="password_confirm" 
              class="input-premium with-icon" 
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
              minlength="6"
              required>
          </div>
          <small class="form-hint-premium">
            Digite a mesma senha para confirmar.
          </small>
        </div>

        <button type="submit" class="btn-submit-premium reset-btn">
          <span>Redefinir Senha</span>
          <i data-feather="check" class="icon"></i>
        </button>
      </form>

      <div class="auth-divider-premium">
        <span>ou</span>
      </div>

      <a href="{{ url_for('users.login') }}" class="btn-back-premium">
        <i data-feather="arrow-left" class="icon"></i>
        <span>Voltar ao login</span>
      </a>
    </div>
  </section>
</div>

<style>
/* Inherit styles from forgot_password above */
.reset-gradient {
  background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%) !important;
}

.reset-btn {
  background: linear-gradient(135deg, #ffecd2, #fcb69f) !important;
  color: #1e293b !important;
  box-shadow: 0 4px 12px rgba(252, 182, 159, 0.3) !important;
}

.reset-btn:hover {
  box-shadow: 0 8px 24px rgba(252, 182, 159, 0.5) !important;
}

.password-strength-tips {
  margin-top: 32px;
  padding: 20px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 14px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.password-strength-tips h3 {
  margin: 0 0 12px 0;
  font-size: 1rem;
  font-weight: 700;
}

.password-strength-tips ul {
  margin: 0;
  padding-left: 20px;
  font-size: 0.88rem;
  line-height: 1.7;
}

.password-strength-tips li {
  opacity: 0.9;
}

.password-strength-bar {
  height: 6px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 3px;
  overflow: hidden;
  margin-top: 8px;
}

.strength-fill {
  height: 100%;
  width: 0;
  border-radius: 3px;
  transition: all 0.3s;
  background: #ef4444;
}

.strength-text {
  display: block;
  margin-top: 6px;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--muted);
}
</style>
{% endblock %}

{% block scripts %}
<script>
  feather.replace();
  
  // Password strength checker
  const passwordInput = document.getElementById('password');
  const confirmInput = document.getElementById('password_confirm');
  const strengthFill = document.getElementById('strengthFill');
  const strengthText = document.getElementById('strengthText');
  const form = document.getElementById('resetForm');
  
  passwordInput.addEventListener('input', function() {
    const password = this.value;
    let strength = 0;
    
    if (password.length >= 6) strength++;
    if (password.length >= 10) strength++;
    if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
    if (/\d/.test(password)) strength++;
    if (/[^a-zA-Z0-9]/.test(password)) strength++;
    
    const percentage = (strength / 5) * 100;
    strengthFill.style.width = percentage + '%';
    
    if (strength === 0) {
      strengthFill.style.background = '#ef4444';
      strengthText.textContent = 'Digite uma senha';
      strengthText.style.color = '#94a3b8';
    } else if (strength <= 2) {
      strengthFill.style.background = '#ef4444';
      strengthText.textContent = 'Senha fraca';
      strengthText.style.color = '#ef4444';
    } else if (strength === 3) {
      strengthFill.style.background = '#f59e0b';
      strengthText.textContent = 'Senha m√©dia';
      strengthText.style.color = '#f59e0b';
    } else if (strength === 4) {
      strengthFill.style.background = '#10b981';
      strengthText.textContent = 'Senha boa';
      strengthText.style.color = '#10b981';
    } else {
      strengthFill.style.background = '#059669';
      strengthText.textContent = 'Senha forte!';
      strengthText.style.color = '#059669';
    }
  });
  
  // Valida√ß√£o de senhas iguais
  form.addEventListener('submit', function(e) {
    if (passwordInput.value !== confirmInput.value) {
      e.preventDefault();
      confirmInput.setCustomValidity('As senhas n√£o coincidem');
      confirmInput.reportValidity();
    }
  });
  
  confirmInput.addEventListener('input', function() {
    this.setCustomValidity('');
  });
</script>
{% endblock %}